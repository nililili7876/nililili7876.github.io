<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>PAMEF3 - Bienvenue en Planète 7876</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Icaurs - Hexo Theme"><meta name="msapplication-TileImage" content="icons/touch-icon-iphone.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Icaurs - Hexo Theme"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="144x144" href="icons/touch-icon-iphone.png"><link rel="apple-touch-icon" sizes="152x152" href="icons/touch-icon-ipad.png"><link rel="apple-touch-icon" sizes="72x72" href="icon/logo.ico"><link rel="apple-touch-icon" sizes="96x96" href="icon/logo.ico"><link rel="apple-touch-icon" sizes="128x128" href="icon/logo.ico"><link rel="apple-touch-icon" sizes="256x256" href="icon/logo.ico"><meta name="description" content="PAMEF3 La synchronisation par la communication CSP"><meta property="og:type" content="blog"><meta property="og:title" content="111"><meta property="og:url" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20221029/ya%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220917210647.jpg"><meta property="og:site_name" content="Bienvenue en Planète 7876"><meta property="og:description" content="PAMEF3 La synchronisation par la communication CSP"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.2h4657urfja0.png"><meta property="og:image" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.64ltsoxqdys0.png"><meta property="og:image" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.6ynjx07g5ek0.png"><meta property="og:image" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.uz0to1hxrm8.png"><meta property="og:image" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/ya72e1e320df67d3408d3b60518260c8c.vv0upfhleo0.jpg"><meta property="og:image" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.7dxrq1tggu40.png"><meta property="og:image" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.6puavojr3xs0.png"><meta property="article:published_time" content="2023-03-21T21:43:34.997Z"><meta property="article:modified_time" content="2023-11-06T09:25:19.856Z"><meta property="article:author" content="7876"><meta property="article:tag" content="并发"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.2h4657urfja0.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://cdn.statically.io/gh/nililili7876/blog_pic@main/20221029/ya微信图片_20220917210647.jpg"},"headline":"PAMEF3","image":["https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.2h4657urfja0.png","https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.64ltsoxqdys0.png","https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.6ynjx07g5ek0.png","https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.uz0to1hxrm8.png","https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/ya72e1e320df67d3408d3b60518260c8c.vv0upfhleo0.jpg","https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.7dxrq1tggu40.png","https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.6puavojr3xs0.png"],"datePublished":"2023-03-21T21:43:34.997Z","dateModified":"2023-11-06T09:25:19.856Z","author":{"@type":"Person","name":7876},"publisher":{"@type":"Organization","name":"Bienvenue en Planète 7876","logo":{"@type":"ImageObject","url":"https://cdn.statically.io/gh/nililili7876/blog_pic@main/20221029/ya39f1ada59d3fa9d65440760f6b18c21.jpg"}},"description":"PAMEF3 La synchronisation par la communication CSP"}</script><link rel="canonical" href="http://nililili7876.cn/2023/03/22/PAMEF3/"><link rel="icon" href="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20221029/ya39f1ada59d3fa9d65440760f6b18c21.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20221029/ya39f1ada59d3fa9d65440760f6b18c21.jpg" alt="Bienvenue en Planète 7876" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com">GitHub</a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-03-21T21:43:34.997Z" title="2023/3/22 05:43:34">2023-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-06T09:25:19.856Z" title="2023/11/6 17:25:19">2023-11-06</time></span><span class="level-item"><a class="link-muted" href="/categories/NANTES/">NANTES</a><span> / </span><a class="link-muted" href="/categories/NANTES/EI2/">EI2</a><span> / </span><a class="link-muted" href="/categories/NANTES/EI2/EI2-3/">EI2_3</a><span> / </span><a class="link-muted" href="/categories/NANTES/EI2/EI2-3/PAMEF/">PAMEF</a></span><span class="level-item">33 minutes read (About 5014 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">PAMEF3</h1><div class="content"><h1 id="pamef3"><a class="markdownIt-Anchor" href="#pamef3"></a> PAMEF3</h1>
<p>La synchronisation par la communication</p>
<p>CSP</p>
<span id="more"></span>
<p>没有共享变量的数据通信(在分布式系统的情况下[cas des systèmes répartis])总是需要同步,不同的数据通信方式示意图：</p>
<p><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.2h4657urfja0.png" alt="yaimage" /></p>
<h2 id="1-csp"><a class="markdownIt-Anchor" href="#1-csp"></a> 1. CSP</h2>
<p>全名: Communicating Sequential Processes, 是langage pour les processus communicants，一种命令式的、并行的语言，通过同步消息交换。</p>
<p>一个例子：由多个进程P, Q, R并行组成的程序</p>
<p><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.64ltsoxqdys0.png" alt="yaimage" /></p>
<p>两个进程P和Q之间的通信命令(输入和输出命令)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">P :: Q ! M(x) //进程P做的事情是：给进程Q发M(x)的消息</span><br><span class="line">Q :: P ? M(y) //进程Q做的事情是：等进程P的消息M(x)</span><br></pre></td></tr></table></figure>
<p>Communication synchrone (rendez-vous) sans mémorisation</p>
<p>bloquante pour l’émetteur[发送] et le récepteur[接收].</p>
<p>建立communication的条件[下面还会出现]:</p>
<ol>
<li>这两个进程显式地称为(P -&gt; Q和Q -&gt; P)</li>
<li>一个是输入命令，一个是输出命令，</li>
<li>消息标识符[l’identificateur du message]和传输数据类型相同</li>
</ol>
<p>dégénérées[退化]形式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//1. signal pur: 没有消息传输:只有一个同步</span><br><span class="line">I. P :: Q ! M() || Q :: P ? M()</span><br><span class="line"></span><br><span class="line">//2.identificateur vide: 没有标识符:消息类型没有歧义</span><br><span class="line">I. P :: Q ! x || Q :: P ? y</span><br></pre></td></tr></table></figure>
<p>PPT上画了一个例子：</p>
<p><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.6ynjx07g5ek0.png" alt="yaimage" /></p>
<h2 id="2-garde"><a class="markdownIt-Anchor" href="#2-garde"></a> 2. Garde</h2>
<p>Garde: 原子评估 de 布尔条件[condition boolénne 简称CB]和 commande d’E/S (CES)。</p>
<p>garde的三种状态：</p>
<p><code>&lt;garde&gt; :: = &lt;CB&gt;,&lt;CES&gt;</code></p>
<ol>
<li>fausse: CB是错的 或者 对应的CES不存在/死亡</li>
<li>vraie: CB是真的 且 对应的CES准备échanger[交换，互通，交流]</li>
<li>neutre: CB是真的但对应的CES不可用</li>
</ol>
<p>是也可以用Commande gardée来评估？</p>
<p><code>&lt;commande gardee&gt; ::=  &lt;garde&gt; -&gt; &lt;suite d'instructions&gt;</code></p>
<p>然后这3个东西也有3个状态</p>
<ol>
<li>garde fausse: commande gardée失败</li>
<li>garde vraie: communication ET exécution de la suite d’instructions qui suit la garde</li>
<li>garde neutre: 等待communication</li>
</ol>
<h2 id="3-programmes-avec-sélectives-répétitives-commandes-dentrée-et-de-sortie"><a class="markdownIt-Anchor" href="#3-programmes-avec-sélectives-répétitives-commandes-dentrée-et-de-sortie"></a> 3. Programmes avec sélectives, répétitives, commandes d’entrée et de sortie</h2>
<p>Sélective</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">		garde_1 -&gt; &lt;liste de commandes&gt;</span><br><span class="line">	[]</span><br><span class="line">		garde_2 -&gt; &lt;liste de commandes&gt;</span><br><span class="line">	[] </span><br><span class="line">		...</span><br><span class="line">	[]</span><br><span class="line">		garde_n -&gt; &lt;liste de commandes&gt;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>choix indéterministe[不确定的] parmi toutes les gardes vraies, attente 如果没有一个是真的 , et échec de la sélective 如果全是Fausse</p>
<p>一个实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">		(state=1) -&gt; state:=state+1;</span><br><span class="line">	[]</span><br><span class="line">		(state=1) -&gt; state:=state-1;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Répétitive</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*[</span><br><span class="line">		garde_1 -&gt; &lt;liste de commandes&gt;</span><br><span class="line">	[]</span><br><span class="line">		garde_2 -&gt; &lt;liste de commandes&gt;</span><br><span class="line">	[] </span><br><span class="line">		...</span><br><span class="line">	[]</span><br><span class="line">		garde_n -&gt; &lt;liste de commandes&gt;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>一遍又一遍地重复，直到所有的gardes都是错误的</p>
<p>又两个实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">x:=1;</span><br><span class="line">*[</span><br><span class="line">		(x&lt;=N) -&gt; imprimer(x); x++;</span><br><span class="line">	[]</span><br><span class="line">		(x=N) -&gt; skip;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">//分割线</span><br><span class="line">*[</span><br><span class="line">	Q?int(x);//该进程等待进程Q</span><br><span class="line">	[</span><br><span class="line">		 (x=N) -&gt; skip;</span><br><span class="line">	[]</span><br><span class="line">		(x&lt;=N) -&gt; imprimer(x);</span><br><span class="line">	]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Programmes avec sélectives, répétitives, commandes d’entrée et de sortie</p>
<p>hors garde: 打印机的进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	P :: a, b: réel;</span><br><span class="line">	[</span><br><span class="line">		b =/= 0 -&gt; IMPRIMANTE ! a/b </span><br><span class="line">	[]</span><br><span class="line">		b = 0 -&gt; Q ! divisionParZéro()</span><br><span class="line">	]//b不为0打印a/b，b为0给Q进程发送消息</span><br><span class="line">||</span><br><span class="line">	Q :: P ? divisionParZéro()//进程Q等待进程P的消息</span><br><span class="line">||//打印机进程</span><br><span class="line">	IMPRIMANTE :: x: reel;</span><br><span class="line">	P ? x;//等待进程P</span><br><span class="line">	imprimer(x)//打印x</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>en garde</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[[  </span><br><span class="line">	//第一个进程 ==&gt; P[1]给x赋值?，等待进程P[2]</span><br><span class="line">	P[1] :: x: entier;</span><br><span class="line">	x := ... ;</span><br><span class="line">	P[2] ! x</span><br><span class="line">||</span><br><span class="line">	//第二个进程</span><br><span class="line">	//给P[2到n]统一赋值x</span><br><span class="line">	(i=2..n) P[i] :: x,val: entier;</span><br><span class="line">	x := ... ;</span><br><span class="line">	*[ P[i-1] ? val -&gt; //等待P[1到n-1]的val</span><br><span class="line">		[ x &lt; val -&gt; P[i+1] ! x ; //如果x &lt; val , 等待P[i+1]并将x赋值为val</span><br><span class="line">				 x := val</span><br><span class="line">		[]</span><br><span class="line">	 	 x &gt;= val -&gt; P[i+1] ! val//如果x &gt;= val,P[i+1]发送消息</span><br><span class="line">		]</span><br><span class="line">	];</span><br><span class="line">	P[i+1] ! x //等待P[n]</span><br><span class="line">||</span><br><span class="line">	P[n+1] :: val: entier;</span><br><span class="line">	*[ P[n] ? val -&gt; imprimer(val) ] //等待P[n]，打印val</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>问这个程序实现了什么</p>
<p>在依次打印长度为n的数组吗？</p>
<p>Cas particulier: 排除了commandes d’entrée ET de sortie en garde</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	//进程P</span><br><span class="line">	P ::</span><br><span class="line">		[ Q ? M1() -&gt; ... //等待Q的信息M1</span><br><span class="line">		 []</span><br><span class="line">		  R ! M2() -&gt; ...//给R发送信息M2</span><br><span class="line">		]</span><br><span class="line">||</span><br><span class="line">	//进程Q</span><br><span class="line">	Q ::</span><br><span class="line">		[ R ? M3() -&gt; ...//等待R的信息M3</span><br><span class="line">		 []</span><br><span class="line">		  P ! M1() -&gt; ...//给P发送信息M1</span><br><span class="line">		]</span><br><span class="line">||</span><br><span class="line">	R ::</span><br><span class="line">	[ P ? M2() -&gt; ...//等待P的M2</span><br><span class="line">	  []</span><br><span class="line">	  Q ! M3() -&gt; ...//给Q发M3</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>
<p>？看着好怪</p>
<p>所有的gardes sont neutres在开始的时候，P与Q通信，Q与R通信，Q与P通信… --&gt; <mark>interblocage</mark> de la communication.解决方法</p>
<ol>
<li>Exclusion[排除] des commandes de sortie en garde</li>
<li>Relâchement[释放] de la condition</li>
</ol>
<p>然后从这里知道建立communication的条件还需要加一条: l’une des commandes (au moins) est hors garde</p>
<h2 id="4-retour-aux-sémaphores"><a class="markdownIt-Anchor" href="#4-retour-aux-sémaphores"></a> 4. Retour aux Sémaphores</h2>
<h3 id="10-version"><a class="markdownIt-Anchor" href="#10-version"></a> 1.0 version</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	SEM ::</span><br><span class="line">		...</span><br><span class="line">			???</span><br><span class="line">||</span><br><span class="line">	(i:1..N) Proc[i] ::</span><br><span class="line">		[ i=1 -&gt; SEM ! init(1) //i=1的话，给进程SEM发送init的消息</span><br><span class="line">		 [] </span><br><span class="line">		  i/=1 -&gt; skip //不然得话就skip</span><br><span class="line">		];</span><br><span class="line">		  ...</span><br><span class="line">		 SEM ! P() ; // 给SEM发送消息P[等待]</span><br><span class="line">			&lt;SC&gt;</span><br><span class="line">		 SEM ! V() ;// 给SEM发送消息V[释放资源]</span><br><span class="line">		... </span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>对应的信号量的算法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">init (x) =</span><br><span class="line">	compteur := x;</span><br><span class="line">fin</span><br><span class="line"></span><br><span class="line">P() =</span><br><span class="line">	compteur := compteur - 1;</span><br><span class="line">	&lt;mettre en attente le processus&gt; si (compteur &lt; 0);</span><br><span class="line">fin</span><br><span class="line"></span><br><span class="line">V() =</span><br><span class="line">	compteur := compteur + 1;</span><br><span class="line">	&lt;libérer un parmi les processus en attente&gt;;</span><br><span class="line">fin</span><br></pre></td></tr></table></figure>
<ol>
<li>1version</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	SEM ::</span><br><span class="line">	entier val := 0;</span><br><span class="line">	* [</span><br><span class="line">		 ([]i:1..N) Proc[i] ? V() -&gt; val := val+1 //进程i等待V的消息，等到的话val+1</span><br><span class="line">	   []</span><br><span class="line">		 ([]i:1..N) val &gt; 0 ; Proc[i] ? P() -&gt; val := val-1//val&gt;0,进程i等待P的消息，等到的话val-1</span><br><span class="line">	   []</span><br><span class="line">		 ([]i:1..N) Proc[i]?init(x) -&gt; val := x//进程i如果等到的是init的消息，将val置为x/1</span><br><span class="line">				% idem Proc[i]?init(val) -&gt; skip//？？？</span><br><span class="line">	]</span><br><span class="line">||</span><br><span class="line">	(i:1..N) Proc[i] ::</span><br><span class="line">		[ i=1 -&gt; SEM ! init(1) //i=1的话，给进程SEM发送init的消息</span><br><span class="line">		 [] </span><br><span class="line">		  i/=1 -&gt; skip //不然得话就skip</span><br><span class="line">		];</span><br><span class="line">		  ...</span><br><span class="line">		 SEM ! P() ; // 给SEM发送消息P[等待]</span><br><span class="line">			&lt;SC&gt;</span><br><span class="line">		 SEM ! V() ;// 给SEM发送消息V[释放资源]</span><br><span class="line">		... </span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>一个丑丑的示意图</p>
<p><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.uz0to1hxrm8.png" alt="yaimage" /></p>
<p>存在信号量操作的不公平[ inéquitable]的情况, 假设是2个进程和1个相互排斥的信号量S</p>
<p><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/ya72e1e320df67d3408d3b60518260c8c.vv0upfhleo0.jpg" alt="ya72e1e320df67d3408d3b60518260c8c" /></p>
<h3 id="20-version"><a class="markdownIt-Anchor" href="#20-version"></a> 2.0 version</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[[ SEM ::</span><br><span class="line">	entier val := 1;</span><br><span class="line">	*[</span><br><span class="line">		([]i:1..N) Proc[i] ? V() -&gt; val := val+1; //进程i等到V[释放]的消息的话先让val+1</span><br><span class="line">				[   val&gt;0 -&gt; skip //val大于0的话，跳过不管</span><br><span class="line">				 [] val&lt;=0 -&gt; ([]j:1..N)Proc[j] ! P() -&gt; skip//val小于0的话，给进程[1到n]的消息发送消息P[等待]</span><br><span class="line">				]</span><br><span class="line">	 []</span><br><span class="line">		([]i:1..N) Proc[i] ? P() -&gt; val := val-1 //进程i等到V[释放]的消息的话先让val-1</span><br><span class="line">				[ val&gt;=0 -&gt; Proc[i] ! P()//val大于0的话，给该进程发送消息P</span><br><span class="line">		 		 [] val&lt;0 -&gt; skip//否则跳过不管</span><br><span class="line">				]</span><br><span class="line">	]</span><br><span class="line">||</span><br><span class="line">	(i:1..N) Proc[i] :: ...</span><br><span class="line">	SEM ! P() ; SEM ? P() ; //给SEM发送消息P，然后等待SEM的P消息</span><br><span class="line">		&lt;SC&gt;</span><br><span class="line">	SEM ! V() ; ... //给SEM发送消息V</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>对应图2</p>
<p><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.7dxrq1tggu40.png" alt="yaimage" /></p>
<h2 id="5-autres-applications"><a class="markdownIt-Anchor" href="#5-autres-applications"></a> 5. Autres applications</h2>
<h3 id="tampon-borné"><a class="markdownIt-Anchor" href="#tampon-borné"></a> Tampon borné</h3>
<p><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20230216/yaimage.6puavojr3xs0.png" alt="yaimage" /></p>
<p>基本框架</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	Buffer ::</span><br><span class="line">	.. tampon[0..N-1];</span><br><span class="line">	entier premier := 0, dernier := 0, n := 0;</span><br><span class="line">	*[ ???????? ]</span><br><span class="line">||</span><br><span class="line">	(i:1..NP) Producteur[i] ::</span><br><span class="line">	*[ ...</span><br><span class="line">		&lt;生产&gt;</span><br><span class="line">		... ]</span><br><span class="line">||</span><br><span class="line">	(i:1..NC) Consommateur[i] ::</span><br><span class="line">	*[ ...</span><br><span class="line">		&lt;消费&gt;</span><br><span class="line">		... ]</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>Version Hoare</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	Buffer ::</span><br><span class="line">	.. tampon[0..N-1];</span><br><span class="line">	entier premier := 0, dernier := 0, nb := 0;</span><br><span class="line">	*[</span><br><span class="line">		//当nb&lt;N[缓冲区大小时],等待生产者i的tampon[dernier]信号，然后nb++，(dernier ++) mod N</span><br><span class="line">		([]i:1..NP) nb &lt; N ; Producteur[i] ? tampon[dernier] -&gt; nb++ ; (dernier ++) mod N;</span><br><span class="line">		//当nb&gt;0[缓冲区有东西可以take],等待消费者i的encore信号，然后给消费发tampon[premier]信号，nb--，(premier ++) mod N</span><br><span class="line">		([]i:1..NC) nb &gt; 0 ; Consommateur[i] ? encore() -&gt;</span><br><span class="line">        										Consommateur[i] ! tampon[premier]</span><br><span class="line">        										nb-- ; (premier ++) mod N;</span><br><span class="line"></span><br><span class="line">	]</span><br><span class="line">||</span><br><span class="line">	(i:1..NP) Producteur[i] ::</span><br><span class="line">	*[ ...</span><br><span class="line">		&lt;生产&gt;</span><br><span class="line">		Buffer ! element_Prod;//给buffer发信号</span><br><span class="line">	 ...]</span><br><span class="line">||</span><br><span class="line">	(i:1..NC) Consommateur[i] ::</span><br><span class="line">	*[ ...</span><br><span class="line">		Buffer ! encore();//给buffer发送encore信号</span><br><span class="line">		Buffer ? element_Cons;//等待buffer的信号</span><br><span class="line">        &lt;消费&gt;</span><br><span class="line">		... ]</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p><mark>EX: Ce programme peut être simplifié en mettant les commandes de sortie en garde. Indiquer comment. 注意通信条件和避免阻塞</mark></p>
<p>Version 2.0</p>
<p>就是把消费发信息的encore给摘走了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">Buffer ::</span><br><span class="line">	.. tampon[0..N-1]; entier premier := 0; dernier := 0; nb := 0;</span><br><span class="line">	*[</span><br><span class="line">		//当nb&lt;N[缓冲区大小时],生产者i等待tampon[dernier]信号，然后nb++，(dernier ++) mod N</span><br><span class="line">		([]i:1..NP) nb &lt; N ; Producteur[i] ? tampon[dernier] -&gt; nb++ ; (dernier ++) mod N;</span><br><span class="line">		//当nb&gt;0[缓冲区有东西可以take],给消费发tampon[premier]信号，nb--，(premier ++) mod N</span><br><span class="line">		([]i:1..NC) nb &gt; 0 ; Consommateur[i] ! tampon[premier] -&gt; nb-- ; (premier ++) mod N;</span><br><span class="line">	]</span><br><span class="line">||</span><br><span class="line">	(i:1..NP) Producteur[i] ::</span><br><span class="line">	*[ ...</span><br><span class="line">		&lt;生产&gt;</span><br><span class="line">		Buffer ! element_Prod;//给buffer发信号</span><br><span class="line">		...</span><br><span class="line">	]</span><br><span class="line">||</span><br><span class="line">	(i:1..NC) Consommateur[i] ::</span><br><span class="line">	*[ ...</span><br><span class="line">		Buffer ? element_Cons;//等待buffer的信号</span><br><span class="line">		&lt;消费&gt;</span><br><span class="line">	... ]</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<h3 id="lecteurs-écrivains"><a class="markdownIt-Anchor" href="#lecteurs-écrivains"></a> Lecteurs-Écrivains</h3>
<p>基本框架</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	//管理共享资源</span><br><span class="line">	CTRL :: . . .</span><br><span class="line">	*[ </span><br><span class="line">		...</span><br><span class="line">	 ]</span><br><span class="line">||</span><br><span class="line">	(i:1..NL) Lecteur[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;lecture&gt;</span><br><span class="line">		CTRL ! Lib() ;//读完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">		... </span><br><span class="line">||</span><br><span class="line">	(i:1..NE) Ecrivain[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;ecriture&gt;</span><br><span class="line">		CTRL ! Lib() ;//写完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">... </span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>补全版：[中间插了一个问题说：Écrire le programme du contrôleur qui permet les accès en<br />
lecture et écriture suivant le protocole qui convient (sans priorité).]</p>
<p>1.0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	//管理共享资源</span><br><span class="line">	CTRL :: </span><br><span class="line">	entier nl := 0; booléen libre := TRUE;</span><br><span class="line">	*[ </span><br><span class="line">		//如果资源libre，等待读者[i]的请求，并且把nl+1</span><br><span class="line">		([]i:1..NL) libre; Lecteur[i] ? Dem() -&gt; nl:=nl+1</span><br><span class="line">		//等待Lecteur[i]的Lib[读完]请求，并且把nl-1</span><br><span class="line">		([]i:1..NL) Lecteur[i] ? Lib() -&gt; nl := nl - 1</span><br><span class="line">		//如果资源libre并且nl=0，等待写者[i]的请求，并且把libre写成F</span><br><span class="line">		([]i:1..NE)(libre &amp;(nl==0));Ecrivain[i]?Dem()-&gt;libre:=FALSE</span><br><span class="line">		//等待Lecteur[i]的Lib[写完]请求，并且把libre变回T</span><br><span class="line">		([]i:1..NE) Ecrivain[i] ? Lib() -&gt; libre := TRUE</span><br><span class="line">		</span><br><span class="line">	 ]</span><br><span class="line">||</span><br><span class="line">	(i:1..NL) Lecteur[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;lecture&gt;</span><br><span class="line">		CTRL ! Lib() ;//读完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">		... </span><br><span class="line">||</span><br><span class="line">	(i:1..NE) Ecrivain[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;ecriture&gt;</span><br><span class="line">		CTRL ! Lib() ;//写完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">... </span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>2.0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	//管理共享资源</span><br><span class="line">	CTRL :: </span><br><span class="line">	entier nl := 0; booléen libre := TRUE;</span><br><span class="line">	*[ </span><br><span class="line">		//如果资源libre，等待读者[i]的请求，并且把nl+1</span><br><span class="line">		([]i:1..NL) libre; Lecteur[i] ? Dem() -&gt; nl:=nl+1</span><br><span class="line">		//等待Lecteur[i]的Lib[读完]请求，并且把nl-1</span><br><span class="line">		([]i:1..NL) Lecteur[i] ? Lib() -&gt; nl := nl - 1</span><br><span class="line">		//如果资源的nl=0，等待写者[i]的请求，然后等他写完</span><br><span class="line">		([]i:1..NE)(nl==0);Ecrivain[i]?Dem()-&gt;Ecrivain[i]?Lib()</span><br><span class="line">	 ]</span><br><span class="line">||</span><br><span class="line">	(i:1..NL) Lecteur[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;lecture&gt;</span><br><span class="line">		CTRL ! Lib() ;//读完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">		... </span><br><span class="line">||</span><br><span class="line">	(i:1..NE) Ecrivain[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;ecriture&gt;</span><br><span class="line">		CTRL ! Lib() ;//写完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">... </span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>然后后面有3个版本avec priorité的</p>
<p>1.写优先：当所有的读者都离开临界区后，才会有写者进入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	//管理共享资源</span><br><span class="line">	CTRL :: </span><br><span class="line">	//nl表示请求读的，ne表示请求写的</span><br><span class="line">	entier nl := 0, ne := 0, k; booleen libre := VRAI;</span><br><span class="line">	*[ </span><br><span class="line">		//如果ne=0[没有写]，等待读者[i]的请求，并且把nl+1</span><br><span class="line">		([]i:1..NL) ne=0, Lecteur[i] ? Dem() -&gt; nl := nl + 1</span><br><span class="line">		//等待Lecteur[i]的Lib[读完]请求，并且把nl-1</span><br><span class="line">		([]i:1..NL) Lecteur[i] ? Lib() -&gt; nl := nl - 1</span><br><span class="line">		//等待写者[i]的请求，并且把ne+1</span><br><span class="line">		([]i:1..NE) Ecrivain[i] ? Dem() -&gt; ne := ne + 1</span><br><span class="line">		//如果nl为0[没有读]并且处于libre状态，给写进程发送Acc，然后把libre设成F，k置为i</span><br><span class="line">		//【这里搞个k的用意在哪里，直接等写完会有什么问题吗？】</span><br><span class="line">		([]i:1..NE) nl=0, libre, Ecrivain[i] ! Acc() -&gt; libre := FAUX; k := i</span><br><span class="line">        [] </span><br><span class="line">        //写完了，libre变T，ne-1</span><br><span class="line">        Ecrivain[k] ? Lib() -&gt; libre := VRAI; ne := ne - 1</span><br><span class="line"></span><br><span class="line">	 ]</span><br><span class="line">||</span><br><span class="line">	(i:1..NL) Lecteur[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;lecture&gt;</span><br><span class="line">		CTRL ! Lib() ;//读完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">		... </span><br><span class="line">||</span><br><span class="line">	(i:1..NE) Ecrivain[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">		CTRL ? Acc() ;//等待CTRL的Acc()</span><br><span class="line">			&lt;ecriture&gt;</span><br><span class="line">		CTRL ! Lib() ;//写完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">... </span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>这个会出现读进程的饥饿–&gt;是因为ne&lt;0会一直在写吗</p>
<p>2.也是写优先</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	//管理共享资源</span><br><span class="line">	CTRL :: </span><br><span class="line">	//nl表示请求读的，ne表示请求写的</span><br><span class="line">	entier nl := 0, ne := 0, k; booleen libre := VRAI;</span><br><span class="line">	*[ </span><br><span class="line">		//等待读者[i]的请求，并且把nl+1</span><br><span class="line">		([]i:1..NL) Lecteur[i] ? Dem() -&gt; nl := nl + 1</span><br><span class="line">		//等待Lecteur[i]的Lib[读完]请求，并且把nl-1</span><br><span class="line">		([]i:1..NL) Lecteur[i] ? Lib() -&gt; nl := nl - 1</span><br><span class="line">		//等待写者[i]的请求</span><br><span class="line">		([]i:1..NE) Ecrivain[i] ? Dem() -&gt; </span><br><span class="line">			*[	//如果nl&gt;0，要等待写进程写完，并且把nl-1</span><br><span class="line">				([]j:1..NL) nl&gt;0; Lecteur[j]?Lib()-&gt;nl:=nl-1</span><br><span class="line">			 ];</span><br><span class="line">			//给写发Acc</span><br><span class="line">			Ecrivain[i] ! Acc(); </span><br><span class="line">			//等他写完</span><br><span class="line">			Ecrivain[i] ? Lib();</span><br><span class="line"></span><br><span class="line">	 ]</span><br><span class="line">||</span><br><span class="line">	(i:1..NL) Lecteur[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;lecture&gt;</span><br><span class="line">		CTRL ! Lib() ;//读完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">		... </span><br><span class="line">||</span><br><span class="line">	(i:1..NE) Ecrivain[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">		CTRL ? Acc() ;//等待CTRL的Acc()</span><br><span class="line">			&lt;ecriture&gt;</span><br><span class="line">		CTRL ! Lib() ;//写完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">... </span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>相较于前面的代码，它增加了一个额外的检查，以确保在写进程请求访问时，没有正在进行的读进程，而读进程的请求则可以在任何时候被满足。这可以有效地避免了饥饿问题。</p>
<p>总的来说，哪个方案更好，取决于具体的应用场景和需求。如果读者的数量远大于写者，那么前面的读者优先的方案可能更适合，因为它可以确保读者总能获得对共享资源的访问权限。但是，如果写者的数量相对较多，或者需要保证写进程能够快速响应，那么后面的写者优先方案可能更合适。</p>
<p>3.还是写优先</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	//管理共享资源</span><br><span class="line">	CTRL :: </span><br><span class="line">	//nl表示请求读的，ne表示请求写的</span><br><span class="line">	entier nl := 0, ne := 0, k; booleen libre := VRAI;</span><br><span class="line">	*[ </span><br><span class="line">		//如果ne=0，等待读者[i]的请求，并且把nl+1</span><br><span class="line">		([]i:1..NL) ne=0; Lecteur[i] ? Dem() -&gt; nl := nl +1</span><br><span class="line">		//等待Lecteur[i]的Lib[读完]请求，并且把nl-1</span><br><span class="line">		([]i:1..NL) Lecteur[i] ? Lib() -&gt; nl := nl - 1</span><br><span class="line">		//等待写者[i]的请求，并且把ne+1</span><br><span class="line">		([]i:1..NE) Ecrivain[i] ? Dem() -&gt; ne := ne + 1</span><br><span class="line">		//如果nl=0，给写者发Acc，然后等写完，ne-1</span><br><span class="line">		([]i:1..NE) nl=0; Ecrivain[i]!Acc() -&gt; Ecrivain[i]?Lib(); ne:=ne-1</span><br><span class="line"></span><br><span class="line">	 ]</span><br><span class="line">||</span><br><span class="line">	(i:1..NL) Lecteur[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">			&lt;lecture&gt;</span><br><span class="line">		CTRL ! Lib() ;//读完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">		... </span><br><span class="line">||</span><br><span class="line">	(i:1..NE) Ecrivain[i] :: ...</span><br><span class="line">		CTRL ! Dem() ;//发送一条请求事件（Dem()），表示它想要读取共享资源</span><br><span class="line">		CTRL ? Acc() ;//等待CTRL的Acc()</span><br><span class="line">			&lt;ecriture&gt;</span><br><span class="line">		CTRL ! Lib() ;//写完成后，读者进程向CTRL进程发送释放事件</span><br><span class="line">... </span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>这个怎么能避免饥饿</p>
<h3 id="philosophes"><a class="markdownIt-Anchor" href="#philosophes"></a> Philosophes</h3>
<p>哲学家就餐问题</p>
<p>CSP的解决方案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	(i:1..N) PHIL ::</span><br><span class="line">	*[ &lt;durant sa vie&gt; -&gt;</span><br><span class="line">		&lt;penser&gt;;</span><br><span class="line">		//给ROOM进程发送进入的消息</span><br><span class="line">		ROOM ! entrer();</span><br><span class="line">		//给FOURCHETTE进程发送要拿的消息</span><br><span class="line">		//i表示右边的，i+1 mod 5表示左边的</span><br><span class="line">		FOURCHETTE(i) ! prendre(); FOURCHETTE(i+1 mod 5) ! prendre();</span><br><span class="line">		&lt;manger&gt;;</span><br><span class="line">		//给FOURCHETTE进程发送要放下的消息</span><br><span class="line">		FOURCHETTE(i) ! poser(); FOURCHETTE(i+1 mod 5) ! poser();</span><br><span class="line">		//给ROOM进程发送离开的消息</span><br><span class="line">		ROOM ! sortir();</span><br><span class="line">	]</span><br><span class="line">	</span><br><span class="line">||</span><br><span class="line">	(i:1..N) FOURCHETTE::</span><br><span class="line">	*[</span><br><span class="line">		//等待拿起，然后等放下</span><br><span class="line">		 PHIL(i) ? prendre() -&gt; PHIL(i)?poser()</span><br><span class="line">		[]</span><br><span class="line">		 PHIL(i-1 mod 5)? prendre()-&gt; PHIL(i-1 mod 5)?poser()</span><br><span class="line">	]</span><br><span class="line">||</span><br><span class="line">	ROOM ::</span><br><span class="line">		entier occupation := 0</span><br><span class="line">		*[</span><br><span class="line">			//进的话occupation++，反之--</span><br><span class="line">			([]i:0..4) PHIL(i)?entrer()-&gt;occupation++;</span><br><span class="line">			([]i:0..4) PHIL(i)?sortir()-&gt;occupation--;</span><br><span class="line">		]</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<h2 id="6-exercice-de-ta"><a class="markdownIt-Anchor" href="#6-exercice-de-ta"></a> 6. Exercice de TA</h2>
<h3 id="1-familiarisation-avec-ctj-et-csp"><a class="markdownIt-Anchor" href="#1-familiarisation-avec-ctj-et-csp"></a> 1. Familiarisation avec CTJ et CSP</h3>
<p>编译并且尝试理解结果</p>
<h3 id="2-lecteurs-écrivains"><a class="markdownIt-Anchor" href="#2-lecteurs-écrivains"></a> 2. Lecteurs-Écrivains</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">define NE 4</span><br><span class="line">define NL 11</span><br><span class="line"></span><br><span class="line">ECRIVAIN ==</span><br><span class="line">	*[ true -&gt;</span><br><span class="line">		sleep (random(10,10000));	</span><br><span class="line">		ctrl!acces ();	</span><br><span class="line">		ressource := ressource + 1;</span><br><span class="line">		sleep (1000);</span><br><span class="line">		ctrl!libere ()</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">LECTEUR ==</span><br><span class="line">	*[ true -&gt;</span><br><span class="line">		ctrl!acces ();</span><br><span class="line">		print (&quot;ressource : &quot; + ressource + &quot;\n&quot;);</span><br><span class="line">		ctrl!libere ()</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line">CTRL ==</span><br><span class="line">	nl : integer := 0;</span><br><span class="line">	*[</span><br><span class="line">		(i:1..NL) lecteur[i]?acces() -&gt; nl := nl + 1; print(&quot;(&quot; + nl + &quot;)&quot; + &quot;\n&quot;)</span><br><span class="line">	[]</span><br><span class="line">		(i:1..NL) lecteur[i]?libere () -&gt; nl := nl - 1</span><br><span class="line">	[]</span><br><span class="line">		(i:1..NE) nl=0; ecrivain[i]?acces () -&gt; ecrivain[i]?libere ()</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line">MAIN == </span><br><span class="line">	ressource : integer := 0;</span><br><span class="line">	[</span><br><span class="line">		ecrivain [i:1..NE] :: ECRIVAIN</span><br><span class="line">	||</span><br><span class="line">		lecteur [i:1..NL] :: LECTEUR</span><br><span class="line">	||	</span><br><span class="line">		ctrl :: CTRL</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>观察它是如何运作的，并突出预期的写进程的“饥饿”现象</p>
</li>
<li>
<p>写程序避免饥饿</p>
<p>改CTRL部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CTRL ==</span><br><span class="line">	nl : integer := 0;</span><br><span class="line">	*[</span><br><span class="line">		(i:1..NL) lecteur[i]?acces() -&gt; nl := nl + 1; </span><br><span class="line">	[]</span><br><span class="line">		(i:1..NL) lecteur[i]?libere () -&gt; nl := nl - 1</span><br><span class="line">	[]</span><br><span class="line">		(i:1..NE) (nl=0) &amp;&amp; (i=1 || !ecrivain[1..i-1]?acces) &amp;&amp; (i=NE || !ecrivain[i+1..NE]?acces) -&gt; ecrivain[i]?acces () -&gt; ecrivain[i]?libere ()</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>比较</p>
</li>
</ol>
<h3 id="3-producteurs-consommateurs"><a class="markdownIt-Anchor" href="#3-producteurs-consommateurs"></a> 3. Producteurs-Consommateurs</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">define NP 1</span><br><span class="line">define NC 4</span><br><span class="line">define N 4</span><br><span class="line"></span><br><span class="line">PRODUCTEUR ==</span><br><span class="line">		nb : integer := 0; message : string;</span><br><span class="line">		*[</span><br><span class="line">			true -&gt;</span><br><span class="line">				message := &quot;objet num &quot; + nb;</span><br><span class="line">				liste!prod(message);</span><br><span class="line">				print (&quot;production &quot; + i + &quot; : &quot; + message + &quot;\n&quot;);</span><br><span class="line">				nb := nb + 1</span><br><span class="line">		]</span><br><span class="line">		</span><br><span class="line">BUFFER ==</span><br><span class="line">		tampon : [0..N-1] string := [0..N-1] &quot;&quot;;</span><br><span class="line">		dernier,premier,nb : integer := 0;</span><br><span class="line">		message : string := &quot;&quot;;</span><br><span class="line">		*[</span><br><span class="line">			(i:1..NP) nb /= N ; producteur[i]?prod(tampon[dernier]) -&gt;</span><br><span class="line">				dernier := (dernier +  1) mod N; nb:=nb+1;</span><br><span class="line">				print (&quot;P - positions &quot; + &quot; : &quot; + premier + dernier + &quot; - nbr d&#x27;elements : &quot; + nb + &quot;\n&quot;)</span><br><span class="line">		[]</span><br><span class="line">			(i:1..NC) nb = N &amp; true; consommateur[i]!cons(tampon[premier],(N+dernier-premier)mod N) -&gt;</span><br><span class="line">				premier := (premier + 1) mod N; nb := nb-1;</span><br><span class="line">				print (&quot;C - positions &quot; + &quot; : &quot; + premier + dernier + &quot; - nbr d&#x27;elements : &quot; + nb + &quot;\n&quot;)</span><br><span class="line">		]		</span><br><span class="line"></span><br><span class="line">CONSOMMATEUR ==</span><br><span class="line">		message : string; k: integer;</span><br><span class="line">		*[ </span><br><span class="line">			true -&gt;</span><br><span class="line">				liste?cons(message,k);</span><br><span class="line">				print (&quot;consommateur &quot; + i + &quot; : &quot; + message + &quot;\n&quot;);</span><br><span class="line">				sleep(500*i)</span><br><span class="line">		]</span><br><span class="line"></span><br><span class="line">MAIN ==</span><br><span class="line">		[</span><br><span class="line">			producteur[i:1..NP] :: PRODUCTEUR</span><br><span class="line">		||</span><br><span class="line">			consommateur[i:1..NC] :: CONSOMMATEUR</span><br><span class="line">		||</span><br><span class="line">			liste :: BUFFER</span><br><span class="line">		]</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>Observer la différence avec l’algorithme correct et corriger l’erreur</p>
</li>
<li>
<p>观察它是如何工作的，并注意由缓冲区组成的“瓶颈”，进程不能在竞争中访问该缓冲区</p>
<p>在生产者和消费者之间设置一个控制进程，该进程负责监视缓冲区中的元素数量，当缓冲区已满时，它会阻止生产者进一步向缓冲区添加数据。同样，当缓冲区为空时，它会阻止消费者从缓冲区中取出数据</p>
</li>
<li>
<p>转换程序来解决这个问题(并设置这些操作的并行执行)</p>
<p>加个CTRL进程：当缓冲区已满时，ctrl会阻止生产者生产更多数据，当缓冲区</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">define NP 1</span><br><span class="line">define NC 4</span><br><span class="line">define N 4</span><br><span class="line"></span><br><span class="line">PRODUCTEUR ==</span><br><span class="line">    nb : integer := 0; message : string;</span><br><span class="line">    *[</span><br><span class="line">        true -&gt;</span><br><span class="line">            message := &quot;objet num &quot; + nb;</span><br><span class="line">            ctrl!prod();</span><br><span class="line">            liste!prod(message);</span><br><span class="line">            print (&quot;production &quot; + i + &quot; : &quot; + message + &quot;\n&quot;);</span><br><span class="line">            nb := nb + 1</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">BUFFER ==</span><br><span class="line">    tampon : [0..N-1] string := [0..N-1] &quot;&quot;;</span><br><span class="line">    dernier,premier,nb : integer := 0;</span><br><span class="line">    message : string := &quot;&quot;;</span><br><span class="line">    *[</span><br><span class="line">        ctrl?prod();</span><br><span class="line">        (i:1..NP) nb /= N ; producteur[i]?prod(tampon[dernier]) -&gt;</span><br><span class="line">            dernier := (dernier +  1) mod N; nb:=nb+1;</span><br><span class="line">            print (&quot;P - positions &quot; + &quot; : &quot; + premier + dernier + &quot; - nbr d&#x27;elements : &quot; + nb + &quot;\n&quot;)</span><br><span class="line">    []</span><br><span class="line">        ctrl?cons();</span><br><span class="line">        (i:1..NC) nb &gt; 0 ; consommateur[i]!cons(tampon[premier],(N+dernier-premier)mod N) -&gt;</span><br><span class="line">            premier := (premier + 1) mod N; nb := nb-1;</span><br><span class="line">            print (&quot;C - positions &quot; + &quot; : &quot; + premier + dernier + &quot; - nbr d&#x27;elements : &quot; + nb + &quot;\n&quot;)</span><br><span class="line">    ]       </span><br><span class="line"></span><br><span class="line">CONSOMMATEUR ==</span><br><span class="line">    message : string; k: integer;</span><br><span class="line">    *[ </span><br><span class="line">        true -&gt;</span><br><span class="line">            ctrl!cons();</span><br><span class="line">            liste?cons(message,k);</span><br><span class="line">            print (&quot;consommateur &quot; + i + &quot; : &quot; + message + &quot;\n&quot;);</span><br><span class="line">            sleep(500*i)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">CTRL ==</span><br><span class="line">    nb : integer := 0;</span><br><span class="line">    *[</span><br><span class="line">        (i:1..NP) nb = N -&gt; producteur[i]?prod(message)</span><br><span class="line">    []</span><br><span class="line">        (i:1..NC) nb = 0 -&gt; consommateur[i]!cons(message,0)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">MAIN ==</span><br><span class="line">    [</span><br><span class="line">        producteur[i:1..NP] :: PRODUCTEUR</span><br><span class="line">    ||</span><br><span class="line">        consommateur[i:1..NC] :: CONSOMMATEUR</span><br><span class="line">    ||</span><br><span class="line">        liste :: BUFFER</span><br><span class="line">    ||</span><br><span class="line">        ctrl :: CTRL</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-synchronisation-des-trains"><a class="markdownIt-Anchor" href="#4-synchronisation-des-trains"></a> 4. Synchronisation des trains</h3>
<ol>
<li>Synchroniser les processus trains pour qu’il n’y ait pas d’accidents (mais que des trains puissent circuler simultanément sur le tronçon partagé lorsqu’ils vont dans le même sens). 同步列车进程，以便不发生事故（但列车在同一方向行驶时可在共享路段同时运行）</li>
<li>Éviter les éventuelles attentes infinies de trains dans un sens (lorsque les autres se liguent pour perpétuellement circuler dans un sens) en imposant qu’il n’y ait pas plus de 5 trains consécutifs dans un sens (si des trains veulent passer dans l’autre sens). 通过规定一个方向上的连续列车不超过5列（如果列车想去另一个方向），避免一个方向上的列车可能出现的无限等待（当其他列车联合起来永远在一个方向上运行）</li>
</ol>
<p>On pourra représenter symboliquement le trajet des trains par l’affichage de chaînes de caractères telles que “A -&gt; B” ou &quot;B -&gt; A“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">define NM 5 // 同方向最多5个</span><br><span class="line"></span><br><span class="line">//搞个缓冲区当路</span><br><span class="line">//不太对，这个只是往右5个</span><br><span class="line">BUFFER ==</span><br><span class="line">	n : integer := 0; </span><br><span class="line">	*[</span><br><span class="line">		(i:1..N) TRAIN[i]?dem() -&gt; (</span><br><span class="line">			directDroite; n &lt; NM ; TRAIN!accD(),n := n+1</span><br><span class="line">		[]</span><br><span class="line">			not directDroite; </span><br><span class="line">			(</span><br><span class="line">				n = 1 ;skip;n: n-1</span><br><span class="line">			[]</span><br><span class="line">				n = 0 ; TRAIN!acc(),n := n+1</span><br><span class="line">			)</span><br><span class="line">		)</span><br><span class="line">		(i:1..N) TRAIN[i]?lib () -&gt;  n := n-1</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line">//往右的火车</span><br><span class="line">TRAINDorite ==</span><br><span class="line">	*[ </span><br><span class="line">		true -&gt;</span><br><span class="line">		ctrl!dem(directDroite);	//发送请求</span><br><span class="line">		ctrl?accD();		//等待许可</span><br><span class="line">		//&lt;SC: 开车,本质是打印&gt;</span><br><span class="line">		t :integer :=  0;</span><br><span class="line">		*[ t&lt;n -&gt;</span><br><span class="line">			print(&quot;t-&gt;&quot;)</span><br><span class="line">			t += 1</span><br><span class="line">		]</span><br><span class="line">		ctrl!lib (); // 释放资源</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line">//往左的火车</span><br><span class="line">TRAINGauche ==</span><br><span class="line">	*[ </span><br><span class="line">		true -&gt;</span><br><span class="line">		ctrl!dem(directGauche);	//发送请求</span><br><span class="line">		ctrl?accG();		//等待许可</span><br><span class="line">		//&lt;SC: 开车,本质是打印&gt;</span><br><span class="line">		t :integer :=  n;</span><br><span class="line">		*[ t&lt;n -&gt;</span><br><span class="line">			print(&quot;t-&gt;&quot;)</span><br><span class="line">			t -= 1</span><br><span class="line">		]</span><br><span class="line">		ctrl!lib (); // 释放资源</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>
<p>写的不行乱七八糟的，看老师写的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">define NAB 10</span><br><span class="line">define NBA 10</span><br><span class="line">define NMAX 5</span><br><span class="line"></span><br><span class="line">CTRL ==</span><br><span class="line">	*[</span><br><span class="line">		(i:1..NAB) nba = 0 &amp; isnabmax = false; trainab[i]?accesa()-&gt;nab := nab+1;nbacons := 0; nabcons := nabcons + 1 ; isnabmax := (nabcons &gt;= NMAX); isnbamax := false</span><br><span class="line">	 []</span><br><span class="line">	 	(i:1..NBA) nab = 0 &amp; isnbamax = false; trainba[i]?accesb()-&gt;nba := nba+1;nabcons := 0; nbacons := nbacons + 1 ; isnbamax := (nbacons &gt;= NMAX); isnabmax := false</span><br><span class="line">	 []</span><br><span class="line">	 	(i:1..NAB) trainab[i]?libereb() -&gt; nab := nab-1</span><br><span class="line">	 []</span><br><span class="line">	 	(i:1..NBA) trainab[i]?liberea() -&gt; nba := nba-1</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line">TRAINAB ==</span><br><span class="line">	*[	true-&gt;</span><br><span class="line">			ctrl!accesa();</span><br><span class="line">			print(&quot;A -&gt; B\n&quot;);</span><br><span class="line">			ctrl!libereb()</span><br><span class="line">	]</span><br><span class="line">TRAINBA ==</span><br><span class="line">	*[	true-&gt;</span><br><span class="line">			ctrl!accesa();</span><br><span class="line">			print(&quot;B -&gt; A\n&quot;);</span><br><span class="line">			ctrl!libereb()</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>
<h2 id="7-chien-de-garde"><a class="markdownIt-Anchor" href="#7-chien-de-garde"></a> 7. Chien de garde</h2>
<p>问题定位：一个进程X必须与一个进程Y进行通信，条件是这种通信在一个时间段t内发生。一个发送ticks的CLOCK进程和一个看门狗进程WDOG</p>
<p>CHAT给出的理解</p>
<ol>
<li>
<p>HORLOGE</p>
<p>HORLOGE是指事件时钟（Event Clock），是用来跟踪系统中的事件发生时间的机制。在CSP编程中，通常使用HORLOGE来管理进程之间的同步和通信。具体来说，HORLOGE会在每个事件发生时记录下事件的发生时间，并通过比较不同进程的事件时间来控制进程的执行顺序。使用HORLOGE可以避免并发程序中的竞态条件和死锁问题。</p>
</li>
<li>
<p>WDOG</p>
<p>WDOG是指看门狗（Watchdog），是用来检测系统中的故障和异常情况的机制。在CSP编程中，通常使用WDOG来检测程序的死锁或其他异常情况。WDOG会在程序中设置一个定时器，并在定时器超时后触发一个异常或中断，从而让程序进行相应的处理，例如重新启动或关闭程序。使用WDOG可以提高程序的稳定性和可靠性。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[[</span><br><span class="line">	Y :: ...</span><br><span class="line">  ||</span><br><span class="line">	X ::</span><br><span class="line">		//给WDOG发送on的消息</span><br><span class="line">		WDOG ! on(t);</span><br><span class="line">		[</span><br><span class="line">			//等待Y的通信的，然后给WDOG发送off的消息，正常启动程序</span><br><span class="line">		  	Y ? communication() -&gt; WDOG !off();&lt;procedure normale&gt;</span><br><span class="line">		  []</span><br><span class="line">		  	//如果受到了WDOG关的消息，发出警告</span><br><span class="line">		  	WDOG !off() -&gt; &lt;procedure alarme&gt;</span><br><span class="line">		]</span><br><span class="line">  ||</span><br><span class="line">  	HORLOGE :: ...</span><br><span class="line">  ||</span><br><span class="line">  WDOG :: t := 0;</span><br><span class="line">  *[</span><br><span class="line">  	  //等待X的on，然后skip</span><br><span class="line">  	  X ? on(t) -&gt; skip</span><br><span class="line">  	[]</span><br><span class="line">  	 //等待x的off，把t置为0</span><br><span class="line">  	  X ? off() -&gt; t := 0</span><br><span class="line">  	[]</span><br><span class="line">  	 //这个进程在干嘛</span><br><span class="line">  	  HORLOGE ? tick()-&gt;[  t&gt;1 -&gt; t := t-1</span><br><span class="line">  	  					 []</span><br><span class="line">  	  					   t=1 -&gt; X?off();t:=0</span><br><span class="line">  	  					 []</span><br><span class="line">  	  					   t=0 -&gt;skip</span><br><span class="line">  	  ]</span><br><span class="line">  ]</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<p>C的MPI，Erlang，Occam</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E5%B9%B6%E5%8F%91/">并发</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/03/22/PAMEF4/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">PAMEF4</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/03/22/PAMEF2/"><span class="level-item">PAMEF2</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://nililili7876.cn/2023/03/22/PAMEF3/';
            this.page.identifier = '2023/03/22/PAMEF3/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + '你来了啊' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://cdn.staticaly.com/gh/nililili7876/blog_pic@main/20221029/ya微信图片_202112041747093.77tsun4ckc80.jpg" alt="7876"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">7876</p><p class="is-size-6 is-block">一个平平无奇的美女罢了</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Nantes France</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">78</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">34</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#pamef3"><span class="level-left"><span class="level-item">1</span><span class="level-item"> PAMEF3</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-csp"><span class="level-left"><span class="level-item">1.1</span><span class="level-item"> 1. CSP</span></span></a></li><li><a class="level is-mobile" href="#2-garde"><span class="level-left"><span class="level-item">1.2</span><span class="level-item"> 2. Garde</span></span></a></li><li><a class="level is-mobile" href="#3-programmes-avec-sélectives-répétitives-commandes-dentrée-et-de-sortie"><span class="level-left"><span class="level-item">1.3</span><span class="level-item"> 3. Programmes avec sélectives, répétitives, commandes d’entrée et de sortie</span></span></a></li><li><a class="level is-mobile" href="#4-retour-aux-sémaphores"><span class="level-left"><span class="level-item">1.4</span><span class="level-item"> 4. Retour aux Sémaphores</span></span></a></li><li><a class="level is-mobile" href="#5-autres-applications"><span class="level-left"><span class="level-item">1.5</span><span class="level-item"> 5. Autres applications</span></span></a></li><li><a class="level is-mobile" href="#6-exercice-de-ta"><span class="level-left"><span class="level-item">1.6</span><span class="level-item"> 6. Exercice de TA</span></span></a></li><li><a class="level is-mobile" href="#7-chien-de-garde"><span class="level-left"><span class="level-item">1.7</span><span class="level-item"> 7. Chien de garde</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://cdn.statically.io/gh/nililili7876/blog_pic@main/20221029/ya39f1ada59d3fa9d65440760f6b18c21.jpg" alt="Bienvenue en Planète 7876" height="28"></a><p class="is-size-7"><span>&copy; 2023 7876</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>